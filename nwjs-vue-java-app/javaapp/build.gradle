
buildscript {
	repositories {
		jcenter()
	}
	dependencies {
		classpath 'de.richsource.gradle.plugins:gwt-gradle-plugin:0.6'
		classpath 'org.ajoberstar:grgit:2.1.0'
	}
}

apply plugin: 'gwt-compiler'


repositories { mavenCentral() }

dependencies {
	compile group: 'com.google.gwt', name: 'gwt-dev', version: '2.8.2'
	compile 'com.google.guava:guava:20.0'
}
gwt {
	gwtVersion='2.8.2'
	minHeapSize = "512M";
	maxHeapSize = "1024M";

	modules 'com.mycompany.javaapp.javaapp'

	compiler {
		optimize = 0;
		style = 'PRETTY' // important
	}
}

task generateSources() {
	outputs.dir "$projectDir/build/generated-sources"
	doLast {
		def grgit = org.ajoberstar.grgit.Grgit.clone(dir: "$projectDir/build/closure-compiler", uri: 'https://github.com/google/closure-compiler.git')
		ant.copy(todir: "${buildDir}/generated-sources/com/google/javascript/jscomp/gwt/linker") {
			fileset (dir: "$projectDir/build/closure-compiler/src/com/google/javascript/jscomp/gwt/linker")
		}
	}
}

sourceSets {
	main.java.srcDirs file("$projectDir/build/generated-sources")
}

compileJava.dependsOn 'generateSources'

build.dependsOn 'compileGwt'